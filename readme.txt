価格.comキーワード検索.alfredworkflowのメモ

機能：
入力した文字列を価格コムで検索
※URLのための％エンコードを実装したワークフローです

インストール：
　1.alfredworkflowをダウンロード
　2.ファイルをダブルクリックしてワークフローに登録

使い方：
　Alfredへの入力
　キーワード（価格 or kakaku）＋パタメータ（検索したい文字列）


開発メモ：

1.検索結果のURLを解析する

　価格コムの検索結果のURLを見てみましょう
　https://kakaku.com/search_results/%98r%8E%9E%8Cv/

　％の記述がありますが、これは日本語をエンコードしたものです
　URLでよく見かけますが、日本語のままではうまく稼働しないブラウザに対応するためコード化しています
　エンコードは文字コードによって異なります
　URLでは基本的にUTF-8を使うものと思っていたので、ちょっと戸惑いました
　
　ネットの世界は便利なもので、デコード（エンコードの反義語で％表記を日本語表記に復元）サイトで確認したところShift-JISでした
　まぁ、主なものは、Shift-JIS、EUC-JP、UTF-8なので確認せずにテストの試行錯誤で解決できますけどね


2．シェルスクリプトで％エンコードする

　URLの構造がわかったら、お次はプログラミング
　シェルスクリプトで実施するにはnkfコマンドを利用するとのこと
　サンプルコマンドをターミナル.appで叩いてたら、nkfがない！

　調べるとどうやらインストールが必要とのこと
　さらに前提としてパッケージ管理環境のhomebrewもインストールが必要らしい
　インターネットを検索すると、いくつも手順出てくるので参考にして実施
　
　苦労して前提ができたところでAlfredのスクリプトを作成
　でも実装したコードはたった3行
　
　キモは下記
　open "https://kakaku.com/search_results/"`echo -n $query | nkf -WsMQ | tr = % `

　バックスラッシュ（｀）の囲みはコマンドの結果を表すので
　echoされる文字列をURLの末尾に結合してできたURLをOPENしています

　echoの中身ですが、基本インターネットからのコピペ。パイプ（|）で処理を連結させています

　①$queryはAlfredから入力された検索キーワード
　②nkfがコード変換ですが、出力がShift-JISなのでパラメータの2文字目にsを指定しています
　③nkfは=でエンコードされるので、trコマンドで=を%に置き換えています

3.その他
　・Alfredのインプットキーワドを”価格”、"Kakaku"として、
　　日本語でも英数でも起動できるようにしています（バイリンガル起動）

　・nkfのパスを環境変数PATHに指定しています（そもそもnkfをパスの通った場所におくべきだったかな）
　　なので、それぞれの環境にあわせた変更が必要です　

背景：
　　価格コムはカメラ、パソコン、家電関連を買う時に参考にするぐらいですが
　　URLに％エンコードがあったのでAlfred化してみました　


